Workstream ID,Workstream Title,Task ID,Task Title,Rationale,Deliverables,Acceptance Criteria,Priority,Phase,Missing Features,Dependencies,Risks/Mitigations,Original Ref,
A,Headless & Determinism,A1,Repository + build sanity,Ensure every dev can build/run starter consistently,maturin develop --release works on macOS/Linux/Windows; toolchains documented,Running `python -m examples.triangle` produces triangle.png; versions pinned,High,MVP,No,None,Toolchain drift → pin Rust/pyo3/wgpu minors,A1.1 Repository + build sanity :contentReference[oaicite:1]{index=1},
A,Headless & Determinism,A2,Deterministic render pipeline setup,Eliminate non-determinism in baseline pipeline,No MSAA; fixed clear color/viewport/scissor; sRGB target,Repeated runs yield identical PNG bytes (hash match),High,MVP,No,A1,Driver variability → lock formats and state,A1.2 Deterministic render pipeline :contentReference[oaicite:2]{index=2},
A,Headless & Determinism,A3,Shader & geometry determinism,Stabilize exact fragment coverage,Canonical triangle (no uniforms); linear interpolation,Edge pixels stable across runs,High,MVP,No,A2,"Degenerate edges → use CCW, cull back face",A1.3 Shader + geometry determinism :contentReference[oaicite:3]{index=3},
C,Core Engine & Target,C1,Engine layout & error type,Create module structure and single error type,"src/context.rs; src/core/{framegraph.rs,gpu_types.rs}; src/error.rs; rewire lib.rs",Compiles; Renderer.info() uses new context; unit tests build,High,MVP,No,None,"API churn → keep small, cohesive error type",Workstream A — Engine layout & error type :contentReference[oaicite:4]{index=4},
C,Core Engine & Target,C2,Off-screen target & readback path (merged),Standardize target and readback,`core/target.rs` (Rgba8UnormSrgb) + row-padding helper,512×512 triangle identical pre/post; correct PNG round-trip,High,MVP,No,C1,Row padding errors → unit test synthetic rows,A1.4 + Core A2 merged :contentReference[oaicite:5]{index=5}; :contentReference[oaicite:6]{index=6},
C,Core Engine & Target,C3,Device diagnostics & feature gating (merged),Deterministic device info and safe limits,Renderer.report_device(); DeviceCaps (limits/MSAA),Reports match backend; MSAA off if unsupported,Medium,MVP,No,C1,Unknown adapters → print caps & guidance,A1.9 + Core A3 merged :contentReference[oaicite:7]{index=7}; :contentReference[oaicite:8]{index=8},
C,Core Engine & Target,C4,Color management & tonemap stub,Linear workflow w/ sRGB output + simple tonemap,WGSL reinhard + gamma 2.2; doc format choices,Shader compiles; CPU ref values match,Medium,MVP,No,C2,Gamma mismatch → unit tests on functions,Core A4 :contentReference[oaicite:9]{index=9},
A,Headless & Determinism,A4,Minimal Python API (spike),Expose minimal API for spike,"Renderer(width,height); render_triangle_rgba(); render_triangle_png(path); info(); type hints/docstrings",`help()` shows clear signatures,High,MVP,No,C1,Interface creep → keep spike surface tiny,A1.5 Python API surface :contentReference[oaicite:10]{index=10},
A,Headless & Determinism,A5,Determinism harness,Automate bitwise/quality checks and backend toggling,SHA-256 equality; SSIM≥0.999 fallback; honor WGPU_BACKEND,Two runs equal hashes; cross-backend SSIM≥0.999,High,MVP,No,A2,Backend differences → tolerate via SSIM,A1.6 Determinism harness :contentReference[oaicite:11]{index=11},
A,Headless & Determinism,A6,Cross-backend runners,Exercise Metal/Vulkan/DX12 explicitly,Script(s) to force backend and run harness,All available backends on host pass criteria,Medium,MVP,No,A5,Unsupported backend → skip with clear message,A1.7 Cross-backend runners :contentReference[oaicite:12]{index=12},
B,Terrain Pipeline,B1,Public API & validation,Define MVP Python→Rust contract for DEMs,"add_terrain(heightmap, spacing, exaggeration, colormap)",Invalid dtype/shape raises clear PyRuntimeError,High,MVP,No,C1,Strided arrays → require C-contig or copy once,T0.1 Public API & validation :contentReference[oaicite:13]{index=13},
B,Terrain Pipeline,B2,DEM stats & normalization,Provide sensible default ranges,Compute h_min/h_max (optionally pct clamp); set_height_range(),Overrides affect render,Medium,MVP,No,B1,Outliers → percentile clamp option,T0.2 DEM statistics :contentReference[oaicite:14]{index=14},
B,Terrain Pipeline,B3,Grid index/vertex generator,Reusable indexed grid for any (W,H),"terrain/mesh.rs::make_grid; pos.xy world; uv [0,1]; u16/u32 indices",1024² grid ≤~40ms; CCW winding tests,High,MVP,No,B1,Index overflow → switch to u32 automatically,T1.1 Grid generator :contentReference[oaicite:15]{index=15}
B,Terrain Pipeline,B4,Height texture upload (R32Float),Upload DEM as single-channel float texture,Texture2D R32Float; COPY_DST; row alignment; linear clamp sampler,Validation clean across backends,High,MVP,No,B1,Alignment bugs → assert 256B stride,T1.2 Height texture upload :contentReference[oaicite:16]{index=16},
B,Terrain Pipeline,B5,Colormap LUT texture,Map heights to colors via small LUT,256×1 RGBA8UnormSrgb; built-in palettes; uniforms h_min/h_max,CPU reference maps match expected colors,Medium,MVP,No,B2,sRGB mismatch → compare in linear space,T1.3 Colormap LUT :contentReference[oaicite:17]{index=17},
D,Camera & Uniforms,D1,Camera math + uniform buffer,Provide view/proj and common globals,"core/camera.rs; Globals UBO (view,proj,sun_dir,exposure,spacing,h_range,exaggeration)",Known-case matrices pass unit tests,High,MVP,No,C1,Handedness confusion → decision doc,T2.1 Camera + UBO :contentReference[oaicite:18]{index=18},
D,Camera & Uniforms,D2,Sun direction & tonemap helpers,Basic lighting helpers,"set_sun(elev,azim); WGSL reinhard+gamma",Shader test vectors ~= CPU ref,Medium,MVP,No,D1,Precision diffs → epsilon bounds,T2.2 Sun & tonemap :contentReference[oaicite:19]{index=19},
B,Terrain Pipeline,B6,Terrain WGSL (vertex),Reconstruct world Z in VS from height texture,VS uses uv→height; set @builtin(position)=proj*view*world,Compiles; coordinates consistent with camera,High,MVP,No,"D1,B3,B4",Coord mismatch → doc conventions,T3.1 Vertex WGSL :contentReference[oaicite:20]{index=20},
B,Terrain Pipeline,B7,Terrain WGSL (fragment),Compute normals + shade,"Forward-diff normals using dx,dy; Lambert+ambient; LUT then tonemap",Sun from east lights east slopes; normal flips with sun_dir,High,MVP,No,"B4,B5,D2",Aliasing → sampleLevel 0 and clamp,T3.2 Fragment WGSL :contentReference[oaicite:21]{index=21},
B,Terrain Pipeline,B8,Pipeline state & bindings,Create render pipeline & bind groups,BG0: Globals; BG1: height+sampler; BG2: colormap+sampler; MSAA=1,Validation layers clean; triangle sample still renders,High,MVP,No,"D1,B4,B5",Layout drift → freeze layouts,T3.3 Pipeline state :contentReference[oaicite:22]{index=22},
B,Terrain Pipeline,B9,Scene integration,Hook terrain into render path,Scene with Layer::Terrain; per-frame update Globals; record draw,First DEM image produced,High,MVP,No,B6–B8,State lifetime → single encoder per frame,T4.1 Scene integration :contentReference[oaicite:23]{index=23},
B,Terrain Pipeline,B10,PNG & NumPy outputs,Parity with spike outputs,"render_rgba()->np.uint8[H,W,4]; render_png(path); reuse readback buffer",1024² outputs correct shapes/dtypes,High,MVP,No,B9,Copy overhead → persistent buffer reuse,T4.2 Outputs :contentReference[oaicite:24]{index=24},
G,Perf & Diagnostics,G1,Synthetic DEM goldens,Deterministic small-input correctness,64×64 gradient + Gaussian goldens; SSIM tests,SSIM≥0.99 across backends,High,MVP,No,B10,Backend variance → tolerance via SSIM,T5.1 Goldens :contentReference[oaicite:25]{index=25},
G,Perf & Diagnostics,G2,Timing harness,Track GPU encode/submit/map times,render_metrics() summary,1024²: render ≤~50ms; readback ≤~30–60ms on mainstream GPU,Medium,MVP,No,B10,CI noise → allow slack,T5.2 Timing harness :contentReference[oaicite:26]{index=26},
E,Docs & Examples,E1,Terrain example script,Show end-to-end DEM usage,examples/terrain_single_tile.py; README usage/perf notes,New dev reproduces in <10 minutes,Medium,MVP,No,B10,Doc drift → keep examples in CI,T5.3 + D3 Example :contentReference[oaicite:27]{index=27},
F,Wheels & Release,F1,Pin toolchains & metadata,Reproducible builds,rust-toolchain.toml; pyo3 abi3-py310; wgpu 0.19.x; requires-python>=3.10,`maturin develop --release` succeeds on all OSes,High,MVP,No,C1,Tool updates break ABI → nightly canary,A4.1 Pin toolchains :contentReference[oaicite:28]{index=28},
F,Wheels & Release,F2,Matrix design & caching,Define CI matrix and caches,Ubuntu/Win/macOS runners; rust/pip caches,Subsequent runs faster; caches used,Medium,MVP,No,F1,Cache poisoning → key by lockfiles,A4.2 Matrix & caching :contentReference[oaicite:29]{index=29},
F,Wheels & Release,F3,CI workflow skeleton,Build wheels + smoke test + artifacts,Actions YAML; import wheel; headless render; upload wheels,All jobs green; artifacts present,High,MVP,No,F2,Adapter issues → prefer software adapter,A4.3 Workflow skeleton :contentReference[oaicite:30]{index=30},
F,Wheels & Release,F4,Fallback adapter option,Improve CI reliability on headless,force_fallback_adapter via env; Renderer.info() prints adapter,Linux uses Lavapipe/SwiftShader when needed,High,MVP,No,C1,False negatives → try HW then SW,A4.4 Fallback adapter :contentReference[oaicite:31]{index=31},
F,Wheels & Release,F5,Wheel compliance checks,Ensure wheel metadata/compliance,auditwheel/delocate; twine check,All checks pass,Medium,MVP,No,F3,Missing deps → fail early,A4.5 Compliance :contentReference[oaicite:32]{index=32},
F,Wheels & Release,F6,sdist build & check,Source distribution works,maturin sdist; twine check; local install smoke,Local sdist install renders image,Medium,MVP,No,F3,Missing sources → verify tarball contents,A4.6 sdist :contentReference[oaicite:33]{index=33},
F,Wheels & Release,F7,TestPyPI publish (manual),Push wheels to TestPyPI,workflow_dispatch job; gh-action-pypi-publish,Install from TestPyPI succeeds,Low,Beyond MVP,No,"F5,F6",Creds/setup → use Trusted Publishing,A4.7 TestPyPI :contentReference[oaicite:34]{index=34},
F,Wheels & Release,F8,Release pipeline to PyPI,Tag-based release,"release.yml on tags; rebuild, check, publish",Tagging publishes successfully,Medium,Beyond MVP,No,"F5,F6",Release mistakes → dry-run to TestPyPI first,A4.8 Release pipeline :contentReference[oaicite:35]{index=35},
F,Wheels & Release,F9,Nightly canary build,Catch dependency regressions,cron nightly; build + smoke + determinism badge,Nightly job runs with notifications,Low,Beyond MVP,No,F3,Noise → badge + notifications only,A4.9 Canary :contentReference[oaicite:36]{index=36},
F,Wheels & Release,F10,Docs & badges,Make build status/docs obvious,Badges; instructions to install wheel artifacts,Badges render; steps copy-pasteable,Low,Beyond MVP,No,F3,Stale badges → update slugs,A4.10 Docs & badges :contentReference[oaicite:37]{index=37},
F,Wheels & Release,F11,Size/perf budget for wheels,Keep wheel sizes reasonable,release profile LTO/thin; strip; print sizes,Typical wheel <10MB; warn if >30MB,Low,Beyond MVP,No,F3,Large deps → audit static links,A4.11 Size/perf budget :contentReference[oaicite:38]{index=38},
H,Vector & Graph Layers,H1,Public API definition (vectors),Freeze Python surface for vectors/graphs,add_polygons/lines/points/graph signatures; doc planar CRS,API imports clean; signatures in help(),Medium,Beyond MVP,No,C3,CRS mistakes → assert planar inputs,V0.1 Public API :contentReference[oaicite:39]{index=39},
H,Vector & Graph Layers,H2,Layer base & render order,Deterministic draw ordering,Layer enum + stable sort; debug labels,Deterministic order across frames,Low,Beyond MVP,No,H1,Overdraw confusion → document order,V0.2 Layer order :contentReference[oaicite:40]{index=40},
H,Vector & Graph Layers,H3,Packed data contracts,Reuse packed formats to limit Python overhead,Polygons/Lines/Points packed buffers; validation errors precise,No extra FFI copies; validations pass,Medium,Beyond MVP,No,H1,Corrupt offsets → strict checks,V1.1 Packed contracts :contentReference[oaicite:41]{index=41},
H,Vector & Graph Layers,H4,Bounds/batching/visibility,Keep draw calls reasonable,Per-layer & per-path AABBs; batch ~100k verts/draw; optional coarse culling,Large inputs split across draws; memory logged,Medium,Beyond MVP,No,H3,Overly large draws → split batches,V1.2 Batching & visibility :contentReference[oaicite:42]{index=42},
H,Vector & Graph Layers,H5,Polygon fill hardening,Robust fill with alpha,Straight-alpha blending; optional per-feature color,Donut renders correctly; no halos,Medium,Beyond MVP,No,H3,Seams → straight-alpha & order,V2.1 Fill pipeline :contentReference[oaicite:43]{index=43},
H,Vector & Graph Layers,H6,Polygon outline refinement,Clean outlines for exteriors/holes,Reuse stroke mesh; world-space width with px clamp,1px-equiv outline visible at all zooms,Low,Beyond MVP,No,H5,Cracks on tight angles → bevel where needed,V2.2 Outline :contentReference[oaicite:44]{index=44},
H,Vector & Graph Layers,H7,Polyline packing & validation,Stable line input paths,"pack_lines(paths) → (coords, offsets); reject <2pt paths",Unit tests for simple/L-shape/degenerate,Medium,Beyond MVP,No,H3,Duplicate verts → dedup consecutive,V3.1 Polyline packing :contentReference[oaicite:45]{index=45},
H,Vector & Graph Layers,H8,Instanced segment expansion (AA lines),AA screen-space width via shader path,VS-expanded quads; miters with limit; FS smoothstep AA,Uniform 2px regardless of zoom; joints correct ≥30°,High,Beyond MVP,No,"H7,D1",Gaps at joins → bevel fallback,V3.2 AA lines :contentReference[oaicite:46]{index=46},
H,Vector & Graph Layers,H9,Caps & joins variants,Expose basic join/cap options,cap: butt/square/round; join: miter/bevel; round cap via SDF,Options switch behavior; visual goldens,Low,Beyond MVP,No,H8,Miter spikes → clamp miter length,V3.3 Caps/joins :contentReference[oaicite:47]{index=47},
H,Vector & Graph Layers,H10,Line batching & perf logging,Scale to many segments,Instance buffer for p0/p1 + color/width; log counts/times,For 1e5 segments,build/draw logged; AA stable,Medium,Beyond MVP,No,H8,Huge inst buffers → split batches,V3.4 Batching :contentReference[oaicite:48]{index=48}
H,Vector & Graph Layers,H11,Points (instanced),Render many points with screen-space sizing,Instanced quads; size/color per-instance; FS SDF disc; batching,1e6 points maintain offline perf headroom; goldens pass,Medium,Beyond MVP,No,H8,Tiny sizes vanish → clamp min px,V4 Points :contentReference[oaicite:49]{index=49},
H,Vector & Graph Layers,H12,Graph packing,Efficient static packing for graph snapshot,Node positions + edge index; optional per-node size/color,1e5 nodes / 2e5 edges pack < few hundred ms,Low,Beyond MVP,No,"H11,H8",Memory spike → log footprint,V5.1 Graph packing :contentReference[oaicite:50]{index=50},
H,Vector & Graph Layers,H13,Graph pipelines,Separate pipelines for edges/nodes,Reuse lines/points; draw order edges→nodes,Goldens for small graph; proper layering,Low,Beyond MVP,No,"H11,H10",Overdraw artifacts → enforce order,V5.2 Graph pipelines :contentReference[oaicite:51]{index=51},
H,Vector & Graph Layers,H14,Vector goldens & metrics,Deterministic baselines for vectors,Tiny goldens polygons/lines/points/graph; SSIM≥0.99; log counts/times,CI passes on Linux/macOS; artifacts uploaded,Low,Beyond MVP,No,H5–H13,Backend variance → SSIM tolerances,V6.1 Goldens & metrics :contentReference[oaicite:52]{index=52},
H,Vector & Graph Layers,H15,README usage (vectors),Explain vector usage & constraints,Examples; CRS/batching/AA notes,Build succeeds; examples render; badges OK,Low,Beyond MVP,No,F3,Misuse of CRS → explicit docs,V6.2 README usage :contentReference[oaicite:53]{index=53},
I,WebGPU Fundamentals (Uniforms/Storage/Instancing),I1,Single-struct uniforms,Add UBO example mirroring lesson,Uniform struct color/scale/offset; one BG per draw; aspect-correct scale,100 triangles render; deterministic PNG test,Low,Beyond MVP,Yes,C1,Bind churn → baseline for SSBO path,New lessons U1 (doc section) — gap synthesized,
I,WebGPU Fundamentals (Uniforms/Storage/Instancing),I2,Many-object per-object UBOs,Show per-object UBO + BG loop,100 objects; compare cost vs instancing,Functional parity; perf notes recorded,Low,Beyond MVP,Yes,I1,BG overhead → documented trade-offs,New lessons U2 — gap synthesized,
I,WebGPU Fundamentals (Uniforms/Storage/Instancing),I3,Split uniforms across UBOs,Split static/dynamic UBOs,Update only dynamic per frame,Byte-accurate dynamic updates; frame time improves,Low,Beyond MVP,Yes,I2,Sync bugs → map/write fences,New lessons U3 — gap synthesized,
I,WebGPU Fundamentals (Uniforms/Storage/Instancing),I4,Storage buffer parity with uniforms,Replace UBOs with SSBOs,read-only storage buffers; same structs,Visual parity; microbench logs,Low,Beyond MVP,Yes,I1,Layout mismatch → align to WGSL rules,New lessons S1 — gap synthesized,
I,WebGPU Fundamentals (Uniforms/Storage/Instancing),I5,Instancing via AoS + instance_index,One draw with many instances,SSBO array-of-structs; instance_index drives per-instance params,100 instances via one draw; deterministic PNG,Medium,Beyond MVP,Yes,I4,Over/under indexing → bounds checks,New lessons S2 — gap synthesized,
I,WebGPU Fundamentals (Uniforms/Storage/Instancing),I6,Split-buffers perf demo,Static vs dynamic SSBOs minimal-change demo,measure BG churn vs single BG,Perf deltas recorded,Low,Beyond MVP,Yes,I4,Noisy results → average over runs,New lessons S3 — gap synthesized,
J,Presentation (Demo-only),J1,Canvas configure & presentation format,Tiny browser demo mirrors headless triangle,use getPreferredCanvasFormat(); present triangle,Demo runs; triangle parity,Low,Beyond MVP,Yes,None,Demo drift → tag as demo-only,New lessons P1 — gap synthesized,
J,Presentation (Demo-only),J2,CSS-scaled canvas vs backing store,Document CSS vs width/height; keep backing store fixed for tests,notes + small demo page,Render correct with CSS scaling; headless unaffected,Low,Beyond MVP,Yes,J1,Confusion → explicit doc section,New lessons P2 — gap synthesized,
K,Skybox & Depth,K1,Textured cube map (skybox),Add cube textures + sampler + view matrix removal for sky,Cube texture + sampler; VS/FS that ignore translation,Correct cube rendering; no seams; validated on headless,Low,Beyond MVP,Yes,"C4,D1",Edge seams → prefiltered mips,New lessons T (skybox) — gap synthesized,
K,Skybox & Depth,K2,Mip generation & sampling for cube,Generate mips and sample correctly,CPU or GPU-generated mips; sampling state verified,Mips visual parity checked,Low,Beyond MVP,Yes,K1,Wrong gamma → generate in linear,New lessons T (mips) — gap synthesized,
K,Skybox & Depth,K3,ViewProjInv plumbing for skybox,Correct transform handling,add viewProjInv where needed; depth test config,Sky renders with depth settings,Low,Beyond MVP,Yes,K1,Matrix mistakes → unit tests,New lessons T — gap synthesized,
K,Skybox & Depth,K4,Depth enablement & less-equal for sky,Depth test config for skybox draw,enable depth; set compare: less-equal,Sky remains visible; terrain still correct,Low,Beyond MVP,Yes,K1,Z-fighting → draw order & bias,New lessons D1 — gap synthesized,
L,Textures & Samplers,L1,Textured quad baseline,Foundation for filtering/wrapping/mips,wgpu headless textured quad; queue.write_texture with padding; Python wrapper,Deterministic 512×512 PNG; validation clean,Low,Beyond MVP,Yes,C2,Stride bugs → assert bytes_per_row%256==0,[TX-01] Textured Quad Baseline :contentReference[oaicite:54]{index=54},
M,Interop & Memory,M1,Zero-copy NumPy interop (RGBA/height),Avoid extra copies across FFI,Borrowed PyArray for inputs/outputs; pointer-equality tests; docs,Pointer equality where possible; no extra memcpy in hot path,High,MVP,Yes,"C1,B10",Accidental copies → audit via profiler,Gap synthesized (PyO3/numpy pattern),
M,Interop & Memory,M2,Memory budget tracker ≤512 MiB,Enforce memory ceiling across textures/buffers,Resource registry that sums sizes; hard/soft limits; metrics,Fail fast when >512 MiB; metrics reported each render,High,MVP,Yes,"C1,B3–B5",Hidden allocations → conservative sizing,Gap synthesized (project constraint),
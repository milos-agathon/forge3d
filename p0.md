Got it—here’s a production-grade, stepwise set of **implementation prompts** you can give to ChatGPT-Codex (or hand to your engineers). Each prompt is scoped, dependency-ordered, and lists explicit backend (Rust/WGSL), frontend (Python), flags, data layouts, tests, and docs. Execute them in order.

---

# P0 — Config & CLI plumbing for Lighting/BRDF/Shadow/GI/Atmosphere (no rendering changes yet)

**Goal:** Introduce typed config, CLI flags, and Python API to select lighting types, BRDFs, shadows, GI, and atmospherics—wired through to the renderer but behind feature gates. No visual change yet.

**Backend (Rust)**

* Add `render/params.rs`:

  * Enums (serde + FromStr):

    ```rust
    #[derive(Clone, Copy, Debug, Serialize, Deserialize)]
    pub enum LightType { Directional, Point, Spot, AreaRect, AreaDisk, AreaSphere, Environment }

    #[derive(Clone, Copy, Debug, Serialize, Deserialize)]
    pub enum BrdfModel { Lambert, Phong, BlinnPhong, OrenNayar, CookTorranceGGX, CookTorranceBeckmann, DisneyPrincipled, AshikhminShirley, Ward, Toon, Minnaert, Subsurface /*screen-space*/, Hair /*KajiyaKay*/ }

    #[derive(Clone, Copy, Debug, Serialize, Deserialize)]
    pub enum ShadowTechnique { Hard, PCF, PCSS, VSM, EVSM, MSM, CSM }

    #[derive(Clone, Copy, Debug, Serialize, Deserialize)]
    pub enum GiMode { None, IBL, IrradianceProbes, DDGI, VoxelConeTracing, SSAO, GTAO, SSGI, SSR }

    #[derive(Clone, Copy, Debug, Serialize, Deserialize)]
    pub enum SkyModel { HosekWilkie, Preetham, HDRI }

    #[derive(Clone, Copy, Debug, Serialize, Deserialize)]
    pub enum VolumetricPhase { Isotropic, HenyeyGreenstein }
    ```
* `LightingParams`, `ShadingParams`, `ShadowParams`, `GiParams`, `AtmosphereParams` structs with sane defaults; all `Serialize/Deserialize`.
* Add `RendererConfig` aggregating the above + validation (e.g., PCSS requires shadow map).
* Thread `RendererConfig` through `Renderer::new(...)` and pipeline creation (no shader changes yet).

**Frontend (Python PyO3)**

* Extend `forge3d.Renderer(...)` to accept `config: dict | Path | None`, plus kwargs mirror:

  * `light=[{type, intensity, color, direction, position, cone_angle, area_extent, hdr_path}]`
  * `brdf="cooktorrance-ggx"`, `shadows="pcf"`, `gi=["ibl","ssao"]`, `sky="hdri"`, `hdr="assets/sky.hdr"`, `volumetric={"density":0.02,"phase":"henyeygreenstein","g":0.8}`.
* Add CLI flags in `examples/terrain_demo.py` (argparse):

  * `--light 'type=directional,dir=0.2,0.8,-0.55,intensity=8,color=1,0.96,0.9'` (repeatable)
  * `--brdf cooktorrance-ggx`
  * `--shadows pcf --shadow-map-res 2048 --cascades 4`
  * `--gi ibl,ssao --hdr assets/sky.hdr`
  * `--sky hosek-wilkie`
  * `--volumetric 'density=0.02,phase=hg,g=0.7'`
* Validate user input → `RendererConfig`.

**Docs/Tests**

* Sphinx “Rendering Options Overview”: tables of flags and defaults.
* Unit test: parsing round-trip (`serde_json`) + Py kwargs → Rust enums.

**Acceptance**

* `RendererConfig` is fully plumbed and visible via `renderer.get_config()` for debugging.

---
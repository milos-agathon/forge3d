# P4 — IBL pipeline (diffuse irradiance + specular prefilter + BRDF LUT)

**Goal:** High-quality environment lighting without RT.

**Backend**

* Offline/first-frame precompute (compute shaders):

  * Convolve HDR to irradiance cube (Lambertian).
  * GGX specular prefilter mip chain (Roughness mapping).
  * BRDF 2D LUT (NdotV × roughness).
* Cache to disk (`.iblcache`) keyed by HDR path, resolution, and GGX settings; reuse across runs.

**WGSL**

* Bindings:

  ```wgsl
  @group(2) @binding(0) var envSpecular: texture_cube<f32>;
  @group(2) @binding(1) var envIrradiance: texture_cube<f32>;
  @group(2) @binding(2) var envSampler: sampler;
  @group(2) @binding(3) var brdfLUT: texture_2d<f32>;
  ```
* `eval_ibl(n, v, base_color, metallic, roughness)` using split-sum.

**CLI**

* `--gi ibl --hdr assets/sky_4k.hdr --ibl-res 256 --ibl-cache .cache/ibl`.

**Acceptance**

* Compare with/without IBL; energy-conserving response; cached precompute time decreases on second run.

---

